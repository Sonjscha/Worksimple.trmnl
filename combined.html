<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>Basis Markup</title>
    <script src= "https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>
   <p><table id="gebuchte Zeiten letzter Monat" border="1">
        <tr>
            <th>nicht abrechenbar</th>
            <th>Vertrag</th>
            <th>Auftrag</th>
            <th>verfügbare Arbeitstage</th>
        </tr>
        <tr>
            <td>20</td>
            <td>19</td>
            <td>18</td>
            <td>17</td>
        </tr>
    </table> </p> 

    <p><table id="gebuchte Zeiten dieser Monat" border="1">
        <tr>
            <th>nicht abrechenbar</th>
            <th>Vertrag</th>
            <th>Auftrag</th>
            <th>verfügbare Arbeitstage</th>
        </tr>
        <tr>
            <td>1</td>
            <td>2</td>
            <td>3</td>
            <td>4</td>
        </tr>
    </table></p> 

        <p><table id="Prognose" border="1">
        <tr>
            <th>nicht abrechenbar</th>
            <th>Vertrag</th>
            <th>Auftrag</th>
            <th>verfügbare Arbeitstage</th>
        </tr>
        <tr>
            <td>9</td>
            <td>3</td>
            <td>1</td>
            <td>0</td>
        </tr>
    </table></p>

    <script> // map() ?

        function tableToJson2(){
            const mapped = new Map([
                []
            ])
        }
        function tableToJson1() {
                    const jsonData = [];
                    const headers = [];

                    $("#id").each(function (index) {
                        if (index === 0) {
                            $(this).find('th').each(function () {
                                headers.push($(this).text());
                            });
                        } else {
                            const rowObject = {};
                            $(this).find('td').each(function (i) {
                                rowObject[headers[i]] = $(this).text();
                            });
                            jsonData.push(rowObject);
                        }
                    });

                    return JSON.stringify(jsonData, null, 2);
                }

                console.log(tableToJson());

        function tableToJson0(table) { 
            // Header aus dem thead oder der ersten Zeile 
            let headers = []; 
            const thead = table.querySelector('thead'); 
            if (thead) { 
                headers = Array.from(thead.querySelectorAll('th')).map(th => th.textContent.trim()); 
            } else { 
                // Falls kein thead: erste Zeile als Header verwenden const firstRow = table.querySelector('tr'); 
                // if (firstRow) { headers = Array.from(firstRow.querySelectorAll('td, th')).map(c => c.textContent.trim()); } }

        // Alle Zeilen außer Header 
        const rows = Array.from(table.querySelectorAll('tbody tr')); 
        const data = rows.map(row => { const cells = Array.from(row.querySelectorAll('td')); 
        const obj = {}; cells.forEach((cell, i) => { const key = headers[i] ??
        col${i + 1}; 
        obj[key] = cell.textContent.trim(); }); return obj; });

        return data; }

        // Anwendung auf alle Tabellen mit IDs const allTables = document.querySelectorAll('table[id]'); 
        // const results = Array.from(allTables).map(table => tableToJson(table));

        // Optional: JSON-String pro Tabelle mit dem Tabellen-Namen als Schlüssel const jsonByTableName = {}; 
        // allTables.forEach(t => { const name = t.id; jsonByTableName[name] = tableToJson(t); });

        console.log(results); // Array pro Tabelle console.log(JSON.stringify(jsonByTableName, null, 2)); 
        // Map: TabellenID -> Array von Objekten
  

    
        /* function tableToJson00() {
            const last = [];
            const now = [];
            const prognose = [];

            $("#gebuchte Zeiten letzter Monat tr").each(function (index) {
                const headersLast = [];
                if (index === 0) {
                    $(this).find('th').each(function () {
                        headersLast.push($(this).text());
                    });
                } else {
                    const rowObjectLast = {};
                    $(this).find('td').each(function (i) {
                        rowObjectLast[headersLast[i]] = $(this).text();
                    });
                    last.push(rowObjectLast);
                }
            });

            $("#gebuchte Zeiten dieser Monat tr").each(function (index) {
                const headersNow = [];
                if (index === 0) {
                    $(this).find('th').each(function () {
                        headersNow.push($(this).text());
                    });
                } else {
                    const rowObjectNow = {};
                    $(this).find('td').each(function (i) {
                        rowObjectNow[headersNow[i]] = $(this).text();
                    });
                    now.push(rowObjectNow);
                }
            });
            
            $("#Prognose tr").each(function (index) {
                const headersProg = [];
                if (index === 0) {
                    $(this).find('th').each(function () {
                        headersProg.push($(this).text());
                    });
                } else {
                    const rowObjectProg = {};
                    $(this).find('td').each(function (i) {
                        rowObjectProg[headersProg[i]] = $(this).text();
                    });
                    prognose.push(rowObjectProg);
                }
            });

                const allTables = document.querySelectorAll('table[id]'); 
                const results = Array.from(allTables).map(table => tableToJson(table));

            return JSON.stringify(results, null, 2);
        }
        console.log(results()); */
    </script>
</body>

</html>